#name: CI
#on:
#  pull_request:
#    branches:
 #     - "main"

#jobs:
 # flutter-test:
 #   name: Run flutter test and analyze
  #  runs-on: ubuntu-latest
  #  steps:
   #   - name: Check out repository
    #    uses: actions/checkout@v3
    #  - name: Setup java
     #   uses: actions/setup-java@v1
      #  with:
      #    java-version: "1.x"
      #- name: Setup flutter
      #  uses: subosito/flutter-action@v2
       # with:
        #  channel: "stable"
        #  cache: "true"
     # - run: flutter pub get
      #- run: flutter analyze
     # - run: flutter test

name: Android Release
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  workflow_dispatch:
    inputs:
      release_notes:
        type: string
        required: true
        default: 'This is a deployed realtor app, feel free to test it!'

jobs:
  version:
    name: Create version number
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Install GitVersion
      uses: gittools/actions/gitversion/setup@v0.9.7
      with:
        versionSpec: "5.x"
    - name: Use GitVersion
      id: gitversion
      uses: gittools/actions/gitversion/execute@v0.9.7
    - name: Create version.txt with nuGetVersion
      run: echo ${{ steps.gitversion.outputs.nuGetVersion  }} > version.txt
    - name: Upload version.txt
      uses: actions/upload-artifact@v2
      with:
        name: gitversion
        path: version.txt

  build:
    name: Create Android Build
    needs: version
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Get version.txt
      uses: actions/download-artifact@v2
      with:
        name: gitversion
    - name: Create new file without newline char from version.txt
      run: tr -d '\n' < version.txt > version1.txt
    - name: Read version
      id: version
      uses: juliangruber/read-file-action@v1
      with:
        path: version1.txt
    - name: Update version in YAML
      run: sed -i 's/99.99.99+99/${{ steps.version.outputs.content }}+${{ github.run_number }}/g' pubspec.yaml
    - name: Print KEYSTORE_BASE64
      run:
      echo "KEYSTORE_BASE64: ${{ secrets.KEYSTORE_BASE64 }}"
   